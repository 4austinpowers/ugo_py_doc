<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Ugo Sparks">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Databases - ugo_py_doc</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Databases";
    var mkdocs_page_input_path = "Databases.md";
    var mkdocs_page_url = "/Databases/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-93008985-2', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> ugo_py_doc</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Basics & More</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../Py_CS/">Python Cheat Sheets</a>
                </li>
                <li class="">
                    
    <a class="" href="../Python_Preliminaries/">Python Preliminaries</a>
                </li>
                <li class="">
                    
    <a class="" href="../Python_Nice_to_Have/">Python Nice to Have</a>
                </li>
                <li class="">
                    
    <a class="" href="../Freeze_the_Code/">Freeze the Code</a>
                </li>
                <li class="">
                    
    <a class="" href="../Decorators/">Decorators</a>
                </li>
                <li class="">
                    
    <a class="" href="../Write_Better_Python/">Write Better Python with PEP</a>
                </li>
                <li class="">
                    
    <a class="" href="../Regex/">Regular Expressions (REGEX)</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Databases</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#2-sqlite3-cli">2, SQLite3 CLI</a></li>
    

    <li class="toctree-l3"><a href="#3-sql-database-gui-administration-and-management-tools">3, SQL Database GUI, Administration, and Management Tools</a></li>
    

    <li class="toctree-l3"><a href="#4-spreadsheet-data-and-sqlite">4, Spreadsheet Data and SQLite</a></li>
    

    <li class="toctree-l3"><a href="#5-r-and-python-with-sql">5, R and Python with SQL</a></li>
    

    <li class="toctree-l3"><a href="#6-the-chinook-sqlite-sample-database">6, The Chinook SQLite Sample Database</a></li>
    

    <li class="toctree-l3"><a href="#7-using-a-python-orm-peewee">7, Using a Python ORM: peewee</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#install-peewee">Install peewee</a></li>
        
            <li><a class="toctree-l4" href="#create-a-database-with-a-script">Create a database with a script</a></li>
        
            <li><a class="toctree-l4" href="#create-read-update-and-delete-crud">Create, read, update, and delete (CRUD)</a></li>
        
            <li><a class="toctree-l4" href="#a-diary-app-the-skeleton-empty-classes-and-functions">A diary app -- The skeleton (empty classes and functions)</a></li>
        
            <li><a class="toctree-l4" href="#a-diary-app-initialize">A diary app -- Initialize</a></li>
        
            <li><a class="toctree-l4" href="#a-diary-app-create-a-menu">A diary app -- Create a menu</a></li>
        
            <li><a class="toctree-l4" href="#a-diary-app-data-entry">A diary app -- Data entry</a></li>
        
            <li><a class="toctree-l4" href="#a-diary-app-search-and-view-entries">A diary app -- Search and view entries</a></li>
        
            <li><a class="toctree-l4" href="#a-diary-app-delete-entries">A diary app -- Delete entries</a></li>
        
            <li><a class="toctree-l4" href="#a-diary-app-finalize-and-polish-up">A diary app -- Finalize and polish up</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../Datetime/">Datetime</a>
                </li>
                <li class="">
                    
    <a class="" href="../Execute_Highlighted_Python_Code_in_gedit/">Execute Highlighted Python Code in gedit</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">SciPy Stack</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../Scipy_CS/">Scipy Stack Cheat Sheets</a>
                </li>
                <li class="">
                    
    <a class="" href="../JN_CS/">Jupyter Notebook Cheat Sheets</a>
                </li>
                <li class="">
                    
    <a class="" href="../Scientific Python (the SciPy Stack)/">Scientific Python (the SciPy Stack)</a>
                </li>
                <li class="">
                    
    <a class="" href="../Importing Data into Python/">Importing Data into Python</a>
                </li>
                <li class="">
                    
    <a class="" href="../Python for Data Science/">Python for Data Science</a>
                </li>
                <li class="">
                    
    <a class="" href="../Tidy_Data_in_Python/">Tidy Data in Python</a>
                </li>
                <li class="">
                    
    <a class="" href="../Lists/">Lists</a>
                </li>
                <li class="">
                    
    <a class="" href="../IPython Notebook/">IPython Notebook, Collection</a>
                </li>
                <li class="">
                    
    <a class="" href="../Python Numpy Arrays/">Python Numpy Arrays</a>
                </li>
                <li class="">
                    
    <a class="" href="../Vectors and Arrays (Linear Algebra)/">Vectors and Arrays (Linear Algebra)</a>
                </li>
                <li class="">
                    
    <a class="" href="../Matplotlib, Python Plotting/">Matplotlib, Python Plotting</a>
                </li>
                <li class="">
                    
    <a class="" href="../Viewing+3D+Volumetric+Data+With+Matplotlib/">Viewing 3D Volumetric Data With Matplotlib</a>
                </li>
                <li class="">
                    
    <a class="" href="../Seaborn, Python Statistical Data Visualization Library/">Seaborn, Python's Statistical Data Visualization Library</a>
                </li>
                <li class="">
                    
    <a class="" href="../Pandas+DataFrames/">Pandas DataFrames</a>
                </li>
                <li class="">
                    
    <a class="" href="../Write Idiomatic Pandas Code/">Write Idiomatic Pandas Code</a>
                </li>
                <li class="">
                    
    <a class="" href="../Exploratory Data Analysis/">Exploratory Data Analysis</a>
                </li>
                <li class="">
                    
    <a class="" href="../Intro to data.world in Python/">Intro to data.world in Python</a>
                </li>
                <li class="">
                    
    <a class="" href="../Python+And+Excel/">Python and Excel</a>
                </li>
                <li class="">
                    
    <a class="" href="../Overview_of_scikit-learn/">Overview of scikit-learn</a>
                </li>
                <li class="">
                    
    <a class="" href="../k-NN_Linear_regression_Logit_Scaling_Centering_Noise/">k-NN, Linear regression, Logit, Scaling, Centering, Noise</a>
                </li>
                <li class="">
                    
    <a class="" href="../Time_Series_Analysis/">Time Series Analysis</a>
                </li>
                <li class="">
                    
    <a class="" href="../Sentiment_Analysis_with_Twitter/">Sentiment Analysis with Twitter</a>
                </li>
                <li class="">
                    
    <a class="" href="../EDA_Machine_Learning_Feature_Engineering_and_Kaggle/">EDA, Machine Learning, Feature Engineering, and Kaggle</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Courses</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../Apprenez a programmer en Python/">Apprenez à programmer en Python</a>
                </li>
                <li class="">
                    
    <a class="" href="../Codecademy Python/">Codecademy Python</a>
                </li>
                <li class="">
                    
    <a class="" href="../Learn Python the Hard Way/">Learn Python the Hard Way</a>
                </li>
                <li class="">
                    
    <a class="" href="../Python Code Snippets/">Python Code Snippets</a>
                </li>
                <li class="">
                    
    <a class="" href="../Introduction to Python/">Introduction to Python</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Manuals</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../Automate the Boring Stuff with Python/">Automate the Boring Stuff with Python</a>
                </li>
                <li class="">
                    
    <a class="" href="../Real_Python/">Real Python</a>
                </li>
                <li class="">
                    
    <a class="" href="../Managing Your Biological Data with Python/">Managing Your Biological Data with Python</a>
                </li>
                <li class="">
                    
    <a class="" href="../Python for Education/">Python for Education</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">ugo_py_doc</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Basics & More &raquo;</li>
        
      
    
    <li>Databases</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <div class="toc"><span class="toctitle">CONTENT</span><ul>
<li><a href="#1-sqlite3">1, SQLite3</a></li>
<li><a href="#2-sqlite3-cli">2, SQLite3 CLI</a></li>
<li><a href="#3-sql-database-gui-administration-and-management-tools">3, SQL Database GUI, Administration, and Management Tools</a></li>
<li><a href="#4-spreadsheet-data-and-sqlite">4, Spreadsheet Data and SQLite</a></li>
<li><a href="#5-r-and-python-with-sql">5, R and Python with SQL</a></li>
<li><a href="#6-the-chinook-sqlite-sample-database">6, The Chinook SQLite Sample Database</a></li>
<li><a href="#7-using-a-python-orm-peewee">7, Using a Python ORM: peewee</a><ul>
<li><a href="#install-peewee">Install peewee</a></li>
<li><a href="#create-a-database-with-a-script">Create a database with a script</a></li>
<li><a href="#create-read-update-and-delete-crud">Create, read, update, and delete (CRUD)</a></li>
<li><a href="#a-diary-app-the-skeleton-empty-classes-and-functions">A diary app &ndash; The skeleton (empty classes and functions)</a></li>
<li><a href="#a-diary-app-initialize">A diary app &ndash; Initialize</a></li>
<li><a href="#a-diary-app-create-a-menu">A diary app &ndash; Create a menu</a></li>
<li><a href="#a-diary-app-data-entry">A diary app &ndash; Data entry</a></li>
<li><a href="#a-diary-app-search-and-view-entries">A diary app &ndash; Search and view entries</a></li>
<li><a href="#a-diary-app-delete-entries">A diary app &ndash; Delete entries</a></li>
<li><a href="#a-diary-app-finalize-and-polish-up">A diary app &ndash; Finalize and polish up</a></li>
</ul>
</li>
</ul>
</div>
<hr />
<p><strong>Foreword</strong></p>
<p>Notes. Python 3. Consult the <a href="http://docs.python-guide.org/en/latest/">Hitchicker&rsquo;s Guide to Python</a>.</p>
<p>Although we work with SQLite, most concepts are applicable to MySQL and PostgreSQL.</p>
<hr />
<h4 id="1-sqlite3">1, SQLite3<a class="headerlink" href="#1-sqlite3" title="Permanent link">&para;</a></h4>
<p>Follow the tutorial on <a href="https://www.tutorialspoint.com">TutorialPoint</a>. Especially the <a href="https://www.tutorialspoint.com/sqlite/sqlite_quick_guide.htm">Quick Guide</a> for installation, basic commands, syntax, comments, SQL statement, data type, affinity type, boolean, date &amp; time, creating a database, a table, dropping a table, querying, operators, expressions, and clauses. Each topic has also a dedicated section such as unions, joins, truncated table, etc.</p>
<ul>
<li>Install.<ul>
<li>Download from the <a href="http://www.sqlite.org/download.html">SQLite website</a>.</li>
<li>Follow the Quick Guide (or find instruction online).</li>
<li>On Windows, databases are located on C:\sqlite.</li>
<li>On Linux, SQLite is in the root directory(/usr/lib/&hellip;), but databases can be stored in the Personal folder (or in a directory of choice; for example, in a new subdirectory under Documents).</li>
</ul>
</li>
</ul>
<h4 id="2-sqlite3-cli">2, SQLite3 CLI<a class="headerlink" href="#2-sqlite3-cli" title="Permanent link">&para;</a></h4>
<p><strong>Basics</strong></p>
<ul>
<li>In the shell/bash:<ul>
<li><code>sqlite3 test.db</code>, create a database/open the database (show the prompt); the database is located in SQLite&rsquo;s directory.</li>
</ul>
</li>
<li>Basic commands inside a database.<ul>
<li><code>.help</code>.</li>
<li><code>.databases</code>, show all databases.</li>
<li><code>create table first (a int, b string);</code>, create a table with two fields.</li>
<li><code>.schema</code>, show the last commands.</li>
<li><code>.tables</code>, show all tables in the database.</li>
<li><code>insert into first (a, b) values (1, "hello");</code>, load the table.</li>
<li><code>select * from first;</code>, extract all values from the table.</li>
<li><code>.quit</code> or <code>.exit</code>.</li>
<li><code>drop table first;</code>, delete a table (first).</li>
<li>Delete a database by deleting the database file in the directory.</li>
</ul>
</li>
<li>Intermediate commands.<ul>
<li><code>.mode insert</code>, change the view (insertions to build the database).</li>
<li><code>.dump</code>, dump data on screen.</li>
<li><code>.output .\Documents\sqlite3Files.sql</code>, create a folder in a file (Windows).</li>
<li><code>.output ./Documents/sqlite3Files.sql</code>, create a folder in a file (UNIX-based).<ul>
<li><code>.dump</code>, dump data into the above. VERY USEFUL for recreating a database/table.</li>
</ul>
</li>
<li><code>.output stdout</code>, to the screen.</li>
<li><code>.mode column</code>, change the view (flat table with fixed width).<br />
        - <code>.width 15 20</code>, define the width by column.<ul>
<li><code>.output ./Documents/sqlite3Files/table.sql</code>, prepare the dump.</li>
<li><code>select * from table;</code>, extract.</li>
<li><code>.output stdout</code>, dump the data.</li>
</ul>
</li>
<li><code>.mode line</code>, change the view (long list without commas).<ul>
<li>Idem.</li>
</ul>
</li>
<li><code>.mode html</code>, change the view (html formats ready to be dumbed).<ul>
<li><code>.output ./Documents/sqlite3Files/table.html</code>, prepare the dump.</li>
<li><code>select * from table;</code>, extract.</li>
<li><code>.output stdout</code>, dump the data.</li>
</ul>
</li>
<li><code>.mode tabs</code>, change the view (flat table separated by tabs).<ul>
<li><code>.output ./Documents/sqlite3Files/table.tsv</code>, prepare the dump.</li>
<li><code>select * from table;</code>, extract.</li>
<li><code>.output stdout</code>, dump the data.</li>
</ul>
</li>
<li><code>.mode csv</code>, change the view (flat table separated by commas or semi-colons).<ul>
<li><code>.separator ;</code>, change the separator.</li>
<li><code>.output ./Documents/sqlite3Files/table.csv</code>, prepare the dump.</li>
<li><code>select * from table;</code>, extract.</li>
<li><code>.output stdout</code>, dump the data.</li>
</ul>
</li>
<li><code>.mode tcs</code>, change the view (flat table with double-quotes).</li>
<li><code>.headers on</code>, show the headers.</li>
<li><code>.show</code>, show the (above) parameters (and change them).</li>
<li><code>.prompt 'sqlite3&gt; '</code>, change the prompt.</li>
<li><code>.read &lt;path&gt;</code>, repopulate the database with the above.</li>
</ul>
</li>
</ul>
<p><strong>Advanced</strong></p>
<p>There are plenty of resources about SQLite: books, online documents, online tutorials, etc. We can learn how to:</p>
<ul>
<li>Build a database, tables.</li>
<li>Query a database, create, alter, select, order by, limit, offset, update, delete, and other functions.</li>
<li>Joins and Triggers.</li>
<li>And more.</li>
</ul>
<h4 id="3-sql-database-gui-administration-and-management-tools">3, SQL Database GUI, Administration, and Management Tools<a class="headerlink" href="#3-sql-database-gui-administration-and-management-tools" title="Permanent link">&para;</a></h4>
<p>With database managers, we can create scripts to automate operations.</p>
<ul>
<li>SQLite is free, open source, and cross-platform.<ul>
<li>DB Browser for SQLite is free, for all OS.</li>
<li>Add-ons to browsers such as the SQLite Managers for Firefox.</li>
</ul>
</li>
<li>MySQL is free, open source, and cross-platform.<ul>
<li>MySQL Workbench is free, for all OS.<ul>
<li>Database Design &amp; Modeling, SQL Development (replacing MySQL Query Browser), and Database Administration (replacing MySQL Administrator). MySQL features: SQL editor, SQL code completion, SQL code formatter, SQL Syntax highlighting, server start/stop, server status/health, server logs, server/replication configuration, user management, session management, and much more.</li>
</ul>
</li>
<li>There are web-based managers.</li>
</ul>
</li>
<li>PostgreSQL is free, open source, also cross-platform.<ul>
<li>pgAdminIII.</li>
<li>There are web-based managers.</li>
</ul>
</li>
<li>SQL in general.<ul>
<li>DB Browser is free, for all OS.</li>
<li>phpMyAdmin is free, for all OS.</li>
<li>Toad is free, for Windows.</li>
<li>HeidiSQL is free, for Windows.</li>
<li>There are web-based managers.</li>
</ul>
</li>
</ul>
<h4 id="4-spreadsheet-data-and-sqlite">4, Spreadsheet Data and SQLite<a class="headerlink" href="#4-spreadsheet-data-and-sqlite" title="Permanent link">&para;</a></h4>
<p><strong>Import from the spreadsheet</strong></p>
<ul>
<li>Pull data from the spreadsheet into SQLite via an add-on or a database manager (automated procedure).</li>
<li>Or export data (save as) from the spreadsheet into a .csv file.</li>
<li>Import the .csv into SQLite.<ul>
<li>In can be done with a manager such as DB Browser for SQLite.</li>
<li>It can be done with a web-based manager such as SQLite Managers for Firefox.</li>
<li>Adjust the general and field parameters.</li>
<li>Create a primary key.</li>
<li>Populate a table with the .csv file.</li>
</ul>
</li>
</ul>
<p><strong>Import into a spreadsheet</strong></p>
<ul>
<li>Dump the data from the CLI or a database manager into a .csv file.</li>
<li>Or connect the spreadsheet with SQLite with built-in functionalities or add-ons to pull data into the database.</li>
<li>There are add-ons that can execute SQL queries in a cell and dump the results in other cells: Excellic, Microsoft SQL Server Data Mining, SaveToDB, Database Connection Wizard, Publish Wizard, etc.</li>
</ul>
<h4 id="5-r-and-python-with-sql">5, R and Python with SQL<a class="headerlink" href="#5-r-and-python-with-sql" title="Permanent link">&para;</a></h4>
<ul>
<li>R can import data from / export data to relational databases using specialized packages such as <code>DBI</code>, <code>RSQLite</code>, <code>RMySQL</code>, <code>RPostgreSQL</code>, etc.</li>
<li>Python libraries are: <code>python-sql</code>, <code>sqlalchemy</code>, <code>records</code>, <code>peewee</code>, etc.<ul>
<li><code>pip install &lt;library&gt;</code>.    </li>
</ul>
</li>
</ul>
<h4 id="6-the-chinook-sqlite-sample-database">6, The Chinook SQLite Sample Database<a class="headerlink" href="#6-the-chinook-sqlite-sample-database" title="Permanent link">&para;</a></h4>
<p>Learn, practice, and test commands with a fake database. </p>
<ul>
<li>Download the <a href="http://chinookdatabase.codeplex.com/">database</a>.</li>
<li>Consult the <a href="../SQLite Sample Database
http://www.sqlitetutorial.net/sqlite-sample-database/">diagram</a>.<ul>
<li>We can also download the database and diagrams.</li>
</ul>
</li>
</ul>
<h4 id="7-using-a-python-orm-peewee">7, Using a Python ORM: <code>peewee</code><a class="headerlink" href="#7-using-a-python-orm-peewee" title="Permanent link">&para;</a></h4>
<h5 id="install-peewee">Install <code>peewee</code><a class="headerlink" href="#install-peewee" title="Permanent link">&para;</a></h5>
<p>We can run queries with SQL or use a Python wrapper: <code>peewee</code>. It is a lightweight Object Relational Mapper (ORM). <code>peewee</code> works with SQLite, MySQL, and PostgreSQL.</p>
<p>Install it with pip.</p>
<p>We can manage our databases with Python scripts.</p>
<h5 id="create-a-database-with-a-script">Create a database with a script<a class="headerlink" href="#create-a-database-with-a-script" title="Permanent link">&para;</a></h5>
<p>In <code>peewee</code>, models are Python classes. Everything in the database is an object: tables, rows, columns, entries, etc.</p>
<p>We create a new database, <code>students.db</code>, with Python. We connect to the database and create two fields with their SQL parameters. We run the script in the terminal.</p>
<pre><code class="python">from peewee import *

db = SqliteDatabase('C:\sqlite\students.db')


class Student(Model): # use a singular name convention
    username = CharField(max_length=255, unique=True) # varchar, unique value, no duplicates
    points = IntegerField(default=0) # if not supplies, it inputs 0 by default

    class Meta: # a class inside a class (meta-class)
        database = db

if __name__ == '__main__': # for running the script directly, not import it
    db.connect()
    db.create_tables([Student], safe=True) # safe is a mandatory convention
</code></pre>

<p>We get no result in the terminal: a good sign. Check out the database to see the results.</p>
<p>The script runs on Windows in Python 2. In Python 3, we would need minor adjustments; they are documented along the way. In addition, in UNIX-based OS, we would need two extra lines at the top of the script.</p>
<pre><code class="python">#!/usr/bin/env python
# -*- coding: utf-8 -*-
</code></pre>

<p>Or.</p>
<pre><code class="python">#!/usr/bin/env python 3
# -*- coding: utf-8 -*-
</code></pre>

<h5 id="create-read-update-and-delete-crud">Create, read, update, and delete (CRUD)<a class="headerlink" href="#create-read-update-and-delete-crud" title="Permanent link">&para;</a></h5>
<p>Create, read, update, and delete is knows as CRUD; the backbone of ORM. Five useful methods:</p>
<ul>
<li><code>.create()</code>, add a new record to the table.</li>
<li><code>.select()</code>, pick rows out of the table.</li>
<li><code>.save()</code>, update an existing row in a table.</li>
<li><code>.get()</code>, fetch a single record from a table.</li>
<li><code>.delete_instance()</code>, delete a row from a table.</li>
</ul>
<p>Improve the script, but avoid the false start&hellip;</p>
<pre><code class="python">from peewee import *

db = SqliteDatabase('C:\sqlite\students.db')


class Student(Model):
    username = CharField(max_length=255, unique=True)
    points = IntegerField(default=0)

    class Meta:
        database = db


# ADD a dictionary
students = [
    {'username': 'kennethliff',
    'points': 4888},
    {'username': 'chalkers',
    'points': 11912},
    {'username': 'joykesten2',
    'points': 7363},
    {'username': 'craigsrob',
    'points': 4079},
    {'username': 'adammcfarland',
    'points': 14717}
]    


def add_students(): # ADD a function
    for student in students:
        Student.create(username=student['username'],
                        points=student['points']) 


if __name__ == '__main__':
    db.connect()
    db.create_tables([Student], safe=True)
    add_students() # ADD
</code></pre>

<p>We can run the script once, but not twice because of the <code>unique=True</code> in the <code>class Student(Model):</code>. We get an <code>IntegrityError</code> in the terminal. </p>
<p>We need to add a <code>try</code> block. Take two.</p>
<pre><code class="python">from peewee import *

db = SqliteDatabase('C:\sqlite\students.db')


class Student(Model):
    username = CharField(max_length=255, unique=True)
    points = IntegerField(default=0)

    class Meta:
        database = db


students = [
    {'username': 'kennethliff',
    'points': 4888},
    {'username': 'chalkers',
    'points': 11912},
    {'username': 'joykesten2',
    'points': 7363},
    {'username': 'craigsrob',
    'points': 4079},
    {'username': 'adammcfarland',
    'points': 14717}
]    


def add_students(): # CHANGE the function
    for student in students:
        try:
            Student.create(username=student['username'],
                            points=student['points'])
        except IntegrityError:
            student_record = Student.get(username=student['username'])
            student_record.points = student['points']
            student_record.save()


if __name__ == '__main__':
    db.connect()
    db.create_tables([Student], safe=True)
    add_students()
</code></pre>

<p>We get no result in the terminal: a good sign. We can run the script at will. We can check out the results in the database.</p>
<p>Add a function to select the top students, order them in descending order (from high to low), and retrieve them.</p>
<pre><code class="python">from peewee import *

db = SqliteDatabase('C:\sqlite\students.db')


class Student(Model):
    username = CharField(max_length=255, unique=True)
    points = IntegerField(default=0)

    class Meta:
        database = db


students = [
    {'username': 'kennethliff',
    'points': 4888},
    {'username': 'chalkers',
    'points': 11912},
    {'username': 'joykesten2',
    'points': 7363},
    {'username': 'craigsrob',
    'points': 4079},
    {'username': 'adammcfarland',
    'points': 14717}
]    


def add_students():
    for student in students:
        try:
            Student.create(username=student['username'],
                            points=student['points'])
        except IntegrityError:
            student_record = Student.get(username=student['username'])
            student_record.points = student['points']
            student_record.save()


def top_student():
    student = Student.select().order_by(Student.points.desc()).get() # ADD
    return student            

if __name__ == '__main__':
    db.connect()
    db.create_tables([Student], safe=True)
    add_students()
    print(&quot;Our top student right now is: {0.username}.&quot;.format(top_student())) # ADD
</code></pre>

<p>This time, we should get a result in the terminal.</p>
<pre><code class="text">Our top student right now is: adammcfarland.
</code></pre>

<p>Change the points in the dictionary and rerun the script.</p>
<pre><code class="python">from peewee import *

db = SqliteDatabase('C:\sqlite\students.db')


class Student(Model):
    username = CharField(max_length=255, unique=True)
    points = IntegerField(default=0)

    class Meta:
        database = db


students = [
    {'username': 'kennethliff',
    'points': 14718}, # CHANGE, make it the top student
    {'username': 'chalkers',
    'points': 11912},
    {'username': 'joykesten2',
    'points': 7363},
    {'username': 'craigsrob',
    'points': 4079},
    {'username': 'adammcfarland',
    'points': 14717}
]    


def add_students():
    for student in students:
        try:
            Student.create(username=student['username'],
                            points=student['points'])
        except IntegrityError:
            student_record = Student.get(username=student['username'])
            student_record.points = student['points']
            student_record.save()


def top_student():
    student = Student.select().order_by(Student.points.desc()).get()
    return student            

if __name__ == '__main__':
    db.connect()
    db.create_tables([Student], safe=True)
    add_students()
    print(&quot;Our top student right now is: {0.username}.&quot;.format(top_student()))
</code></pre>

<p>Results in the terminal.</p>
<pre><code class="text">Our top student right now is: kennethliff.
</code></pre>

<p><strong>Recap:</strong></p>
<ul>
<li><code>.create()</code>, add a new record to the table.</li>
<li><code>.select()</code>, pick rows out of the table.</li>
<li><code>.get()</code>, fetch a single record from a table.</li>
</ul>
<h5 id="a-diary-app-the-skeleton-empty-classes-and-functions">A diary app &ndash; The skeleton (empty classes and functions)<a class="headerlink" href="#a-diary-app-the-skeleton-empty-classes-and-functions" title="Permanent link">&para;</a></h5>
<p>Now, let&rsquo;s build a diary application using an SQLite database. Such an application can be integrated into a web framework (like Flask) or frozen as an executive file (embedding SQLite). </p>
<p>We want to be able to load data and retrieve them. </p>
<p>The more general use could be a log book: we can write stuff and retrieve it. We can classify the entries and search for a specific word.</p>
<p>We start with a skeleton, bare functions and docstrings.</p>
<pre><code class="python">from peewee import *

db = SqliteDatabase('C:\sqlite\diary.db')


class Entry(Model):
    # content
    # timestamp

    class Meta:
        database = db


def menu_loop():
    &quot;&quot;&quot;Show the menu.&quot;&quot;&quot;


def add_entry():
    &quot;&quot;&quot;Add an entry.&quot;&quot;&quot;


def view_entries():
    &quot;&quot;&quot;View previous entries.&quot;&quot;&quot;


def delete_entry(entry):
    &quot;&quot;&quot;Delete an entry.&quot;&quot;&quot;


if __name__ == '__main__': # for running the script directly, not import it
    menu_loop()
</code></pre>

<h5 id="a-diary-app-initialize">A diary app &ndash; Initialize<a class="headerlink" href="#a-diary-app-initialize" title="Permanent link">&para;</a></h5>
<p>Let&rsquo;s add some flesh to the skeleton. Add the the <code>datetime</code> library and a new function to initialize the diary.</p>
<pre><code class="python">import datetime # ADD
from peewee import *

db = SqliteDatabase('C:\sqlite\diary.db')


class Entry(Model): # CHANGE
    content = TextField() # content: TextField ia more flexible, holds any type of data; contrary to CharField, a varchar with a maximum length
    timestamp = DateTimeField(default=datetime.datetime.now) # timestamp; now does take parentheses

    class Meta:
        database = db


def initialize(): # ADD
    &quot;&quot;&quot;Create the database and the table if they don't exist.&quot;&quot;&quot;
    db.connect()
    db.create_tables([Entry], safe=True)


def menu_loop():
    &quot;&quot;&quot;Show the menu.&quot;&quot;&quot;


def add_entry():
    &quot;&quot;&quot;Add an entry.&quot;&quot;&quot;


def view_entries():
    &quot;&quot;&quot;View previous entries.&quot;&quot;&quot;


def delete_entry(entry):
    &quot;&quot;&quot;Delete an entry.&quot;&quot;&quot;


if __name__ == '__main__': # for running the script directly, not import it
    initialize() # INSERT
    menu_loop()
</code></pre>

<p>We get no result in the terminal: a good sign. We can check out the results in the db.</p>
<h5 id="a-diary-app-create-a-menu">A diary app &ndash; Create a menu<a class="headerlink" href="#a-diary-app-create-a-menu" title="Permanent link">&para;</a></h5>
<p>We add a menu using a dictionary (we need the <code>OrderedDict</code> library).</p>
<pre><code class="python">from collections import OrderedDict # ADD
import datetime
from peewee import *

db = SqliteDatabase('C:\sqlite\diary.db')


class Entry(Model):
    content = TextField()
    timestamp = DateTimeField(default=datetime.datetime.now)

    class Meta:
        database = db


def initialize():
    &quot;&quot;&quot;Create the database and the table if they don't exist.&quot;&quot;&quot;
    db.connect()
    db.create_tables([Entry], safe=True)


def menu_loop():
    &quot;&quot;&quot;Show the menu.&quot;&quot;&quot;
    choice = None # new variable with a default value

    while choice != 'q': # ADD
        print(&quot;Enter 'q' to quit.&quot;) # starting message
        for key, value in menu.items(): # loop through the dictionary
            print('{}) {}'.format(key, value.__doc__)) # value from the menu variables furthur down in the script; __doc__ is the docstrings
        choice = raw_input('Action: ').lower().strip() # lowercase, remove white spaces

        if choice in menu: # check if the selection is in the menu
            menu[choice]() # execute the choice

def add_entry():
    &quot;&quot;&quot;Add an entry.&quot;&quot;&quot;


def view_entries():
    &quot;&quot;&quot;View previous entries.&quot;&quot;&quot;


def delete_entry(entry):
    &quot;&quot;&quot;Delete an entry.&quot;&quot;&quot;


menu = OrderedDict([ # ADD tuple
    ('a', add_entry),
    ('v', view_entries),
])


if __name__ == '__main__':
    initialize()
    menu_loop()
</code></pre>

<p>This is coded in Python 2. In Python 3, we would replace <code>raw_input</code> by <code>input</code>.</p>
<p>The result is dynamic. We can input data in the terminal and the script continues to run until we quit with <code>q</code>. We cannot do much since the functions are still empty (<code>def add_entry():</code> and <code>def view_entries():</code>). The following is a snapshot.</p>
<pre><code class="text">Enter 'q' to quit.
a) Add an entry.
v) View previous entries.
Actions:
</code></pre>

<h5 id="a-diary-app-data-entry">A diary app &ndash; Data entry<a class="headerlink" href="#a-diary-app-data-entry" title="Permanent link">&para;</a></h5>
<p>Add the <code>sys</code> library. We want to enter data and load the database.</p>
<pre><code class="python">from collections import OrderedDict
import datetime
import sys # ADD
from peewee import *

db = SqliteDatabase('C:\sqlite\diary.db')


class Entry(Model):
    content = TextField()
    timestamp = DateTimeField(default=datetime.datetime.now)

    class Meta:
        database = db


def initialize():
    &quot;&quot;&quot;Create the database and the table if they don't exist.&quot;&quot;&quot;
    db.connect()
    db.create_tables([Entry], safe=True)


def menu_loop():
    &quot;&quot;&quot;Show the menu.&quot;&quot;&quot;
    choice = None

    while choice != 'q':
        print(&quot;Enter 'q' to quit.&quot;)
        for key, value in menu.items():
            print('{}) {}'.format(key, value.__doc__))
        choice = raw_input('Action: ').lower().strip()

        if choice in menu:
            menu[choice]()


def add_entry(): # IMPROVE
    &quot;&quot;&quot;Add an entry.&quot;&quot;&quot;
    print(&quot;Enter your entry. Press ctrl+z when finished.&quot;)
    data = sys.stdin.read().strip()

    if data:
        if raw_input('Save entry? [Yn] ').lower() != 'n':
            Entry.create(content=data)
            print(&quot;Saved successfully!&quot;)


def view_entries():
    &quot;&quot;&quot;View previous entries.&quot;&quot;&quot;


def delete_entry(entry):
    &quot;&quot;&quot;Delete an entry.&quot;&quot;&quot;


menu = OrderedDict([
    ('a', add_entry),
    ('v', view_entries),
])


if __name__ == '__main__':
    initialize()
    menu_loop()
</code></pre>

<p>The result is dynamic.</p>
<p>To the question <code>Enter your entry. Press ctrl+d when finished.</code>, write <code>Working with databases. I enjoy my day.</code>. Press enter, then press ctrl+z, then enter in Windows, ctrl+d in UNIX-based OS (for End-of-File key sequence). Save it (with a <code>y</code> input). Repeat. This time, do not save it (<code>n</code>). Check out the results in the database.</p>
<p><code>raw_input</code> in Python 2 vs. <code>input</code> in Python 3. In Python 2, we can print with <code>print " "</code> or <code>print(" ")</code>. The later is only possible in Python 3.</p>
<h5 id="a-diary-app-search-and-view-entries">A diary app &ndash; Search and view entries<a class="headerlink" href="#a-diary-app-search-and-view-entries" title="Permanent link">&para;</a></h5>
<p>We now want to read the data (query the database). We also want to search throught the entries. In SQL, we would code: <code>SELECT * FROM entry WHERE content LIKE '%search_query$' ORDER BY timestamp DESC;</code>.</p>
<pre><code class="python">from collections import OrderedDict
import datetime
import sys
from peewee import *

db = SqliteDatabase('C:\sqlite\diary.db')


class Entry(Model):
    content = TextField()
    timestamp = DateTimeField(default=datetime.datetime.now)

    class Meta:
        database = db


def initialize():
    &quot;&quot;&quot;Create the database and the table if they don't exist.&quot;&quot;&quot;
    db.connect()
    db.create_tables([Entry], safe=True)


def menu_loop():
    &quot;&quot;&quot;Show the menu.&quot;&quot;&quot;
    choice = None

    while choice != 'q':
        print(&quot;Enter 'q' to quit.&quot;)
        for key, value in menu.items():
            print('{}) {}'.format(key, value.__doc__))
        choice = raw_input('Action: ').lower().strip()

        if choice in menu:
            menu[choice]()


def add_entry():
    &quot;&quot;&quot;Add an entry.&quot;&quot;&quot;
    print(&quot;Enter your entry. Press ctrl+z when finished.&quot;)
    data = sys.stdin.read().strip()

    if data:
        if raw_input('Save entry? [Yn] ').lower() != 'n':
            Entry.create(content=data)
            print(&quot;Saved successfully!&quot;)


def view_entries(search_query=None): # IMPROVE
    &quot;&quot;&quot;View previous entries.&quot;&quot;&quot;
    entries = Entry.select().order_by(Entry.timestamp.desc()) # sort them
    if search_query:
        entries = entries.where(Entry.content.contains(search_query))

    for entry in entries:
        timestamp = entry.timestamp.strftime('%A %B %d, %Y %I:%M%p') # day name, month, date, year, hour (12h), minute, am/pm
        print(timestamp)
        print('='*len(timestamp)) # print the number of characters in the timestamp
        print(entry.content)
        print('n) next entry')
        print('q) return to main menu')

        next_action = raw_input('Action: [Nq] ').lower().strip()
        if next_action == 'q':
            break


def search_entries():
    &quot;&quot;&quot;Search entries for a string.&quot;&quot;&quot;
    view_entries(raw_input('Search query: '))


def delete_entry(entry):
    &quot;&quot;&quot;Delete an entry.&quot;&quot;&quot;


menu = OrderedDict([
    ('a', add_entry),
    ('v', view_entries),
    ('s', search_entries), # ADD
])


if __name__ == '__main__':
    initialize()
    menu_loop()
</code></pre>

<p>The result is dynamic. Try entering stuff, save it. Back to the menu, read the entry. We should get a date, a line of <code>=</code> and the entry. Quit and go back to the menu. Try search for a word. It should find a single word among all the entry and pull out the entry where the word appears.</p>
<h5 id="a-diary-app-delete-entries">A diary app &ndash; Delete entries<a class="headerlink" href="#a-diary-app-delete-entries" title="Permanent link">&para;</a></h5>
<p>Complete the last function: <code>def delete_entry(entry):</code>.</p>
<pre><code class="python">from collections import OrderedDict
import datetime
import sys
from peewee import *

db = SqliteDatabase('C:\sqlite\diary.db')


class Entry(Model):
    content = TextField()
    timestamp = DateTimeField(default=datetime.datetime.now)

    class Meta:
        database = db


def initialize():
    &quot;&quot;&quot;Create the database and the table if they don't exist.&quot;&quot;&quot;
    db.connect()
    db.create_tables([Entry], safe=True)


def menu_loop():
    &quot;&quot;&quot;Show the menu.&quot;&quot;&quot;
    choice = None

    while choice != 'q':
        print(&quot;Enter 'q' to quit.&quot;)
        for key, value in menu.items():
            print('{}) {}'.format(key, value.__doc__))
        choice = raw_input('Action: ').lower().strip()

        if choice in menu:
            menu[choice]()


def add_entry():
    &quot;&quot;&quot;Add an entry.&quot;&quot;&quot;
    print(&quot;Enter your entry. Press ctrl+z when finished.&quot;)
    data = sys.stdin.read().strip()

    if data:
        if raw_input('Save entry? [Yn] ').lower() != 'n':
            Entry.create(content=data)
            print(&quot;Saved successfully!&quot;)


def view_entries(search_query=None):
    &quot;&quot;&quot;View previous entries.&quot;&quot;&quot;
    entries = Entry.select().order_by(Entry.timestamp.desc())
    if search_query:
        entries = entries.where(Entry.content.contains(search_query))

    for entry in entries:
        timestamp = entry.timestamp.strftime('%A %B %d, %Y %I:%M%p')
        print(timestamp)
        print('='*len(timestamp))
        print(entry.content)
        print('n) next entry')
        print('d) delete entry') # ADD
        print('q) return to main menu')

        next_action = raw_input('Action: [Ndq] ').lower().strip()
        if next_action == 'q':
            break
        elif next_action == 'd': # ADD
            delete_entry(entry)


def search_entries():
    &quot;&quot;&quot;Search entries for a string.&quot;&quot;&quot;
    view_entries(raw_input('Search query: '))


def delete_entry(entry): # IMPROVE
    &quot;&quot;&quot;Delete an entry.&quot;&quot;&quot;
    if raw_input(&quot;Are you sure? [yN] &quot;).lower() == 'y':
        entry.delete_instance()
        print(&quot;Entry deleted!&quot;)


menu = OrderedDict([
    ('a', add_entry),
    ('v', view_entries),
    ('s', search_entries),
])


if __name__ == '__main__':
    initialize()
    menu_loop()
</code></pre>

<p>The result is dynamic. Enter something. Save it. View it. Delete it (the last entry). Confirm it. Go back to the main menu. View the previous entries. The last entry was deleted and we see the previous entry.</p>
<h5 id="a-diary-app-finalize-and-polish-up">A diary app &ndash; Finalize and polish up<a class="headerlink" href="#a-diary-app-finalize-and-polish-up" title="Permanent link">&para;</a></h5>
<p>We can polish up the final result. We need to ventilate the onscreen printouts by cleaning the screen here and there. On Windows, we clear the screen with <code>cls</code>; on UNIX-based OS, with <code>clear</code>.</p>
<p>Here is the final product. It&rsquo;s not perfect, but it works.</p>
<pre><code class="python">from collections import OrderedDict
import datetime
import os # ADD
import sys
from peewee import *

db = SqliteDatabase('C:\sqlite\diary.db')


class Entry(Model):
    content = TextField()
    timestamp = DateTimeField(default=datetime.datetime.now)

    class Meta:
        database = db


def initialize():
    &quot;&quot;&quot;Create the database and the table if they don't exist.&quot;&quot;&quot;
    db.connect()
    db.create_tables([Entry], safe=True)


def clear(): # ADD
    os.system('cls' if os.name == 'nt' else 'clear') # ADD; cls for Windows, clear for Linux or Mac OS X


def menu_loop():
    &quot;&quot;&quot;Show the menu.&quot;&quot;&quot;
    choice = None

    while choice != 'q':
        clear()
        print(&quot;Enter 'q' to quit.&quot;)
        for key, value in menu.items():
            print('{}) {}'.format(key, value.__doc__))
        choice = raw_input('Action: ').lower().strip()

        if choice in menu:
            clear()
            menu[choice]()


def add_entry():
    &quot;&quot;&quot;Add an entry.&quot;&quot;&quot;
    print(&quot;Enter your entry. Press ctrl+z when finished.&quot;)
    data = sys.stdin.read().strip()

    if data:
        if raw_input('Save entry? [Yn] ').lower() != 'n':
            Entry.create(content=data)
            print(&quot;Saved successfully!&quot;)


def view_entries(search_query=None):
    &quot;&quot;&quot;View previous entries.&quot;&quot;&quot;
    entries = Entry.select().order_by(Entry.timestamp.desc())
    if search_query:
        entries = entries.where(Entry.content.contains(search_query))

    for entry in entries:
        timestamp = entry.timestamp.strftime('%A %B %d, %Y %I:%M%p')
        clear()
        print(timestamp)
        print('='*len(timestamp))
        print(entry.content)
        print('\n\n'+'='*len(timestamp)) # ADD
        print('n) next entry')
        print('d) delete entry')
        print('q) return to main menu')

        next_action = raw_input('Action: [Ndq] ').lower().strip()
        if next_action == 'q':
            break
        elif next_action == 'd':
            delete_entry(entry)


def search_entries():
    &quot;&quot;&quot;Search entries for a string.&quot;&quot;&quot;
    view_entries(raw_input('Search query: '))


def delete_entry(entry):
    &quot;&quot;&quot;Delete an entry.&quot;&quot;&quot;
    if raw_input(&quot;Are you sure? [yN] &quot;).lower() == 'y':
        entry.delete_instance()
        print(&quot;Entry deleted!&quot;)


menu = OrderedDict([
    ('a', add_entry),
    ('v', view_entries),
    ('s', search_entries),
])


if __name__ == '__main__':
    initialize()
    menu_loop()
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Datetime/" class="btn btn-neutral float-right" title="Datetime">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Regex/" class="btn btn-neutral" title="Regular Expressions (REGEX)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>© Ugo Sparks</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../Regex/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Datetime/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
      <script src="../mathjaxhelper.js"></script>

</body>
</html>
